<!DOCTYPE html>
<html>
<head>
	<title>Wecker</title>
	<!--<link rel="shortcut icon" href=http://lff.l3p3.de/favicon.png>-->
	<meta charset=utf-8>
	<meta name=viewport content="width=device-width">
	<!--<link rel=stylesheet type=text/css href=/css/main.css>-->
	<!--<script src="/scripts/import.js"></script>-->
	<!--<script src="https://lff.l3p3.de/files/other/lui/lui.dev.js"></script>-->
	<script src=https://cdn.jsdelivr.net/gh/L3P3/lui@v1.3.x/lui.dev.js></script>
</head>
<body>
<h1>JavaScript is disabled</h1>
<button onclick="location.reload();">reload page</button>
<script>
const {
	init,
	node,
	node_dom,
	node_map,
	hook_model,
	hook_effect,
}=lui;

const model={
	init:()=>{
		const entries=localStorage.getItem("wecker_entries");
		const state={
			editing:-1,
			entries:entries
			?
				JSON.parse(entries)
			:
				[
					{
						id:Date.now(),
						name:"demo",
						time:"12:00",
					},
				],
		};
		return state;
	},
	addEntry:(state,item)=>({
		...state,
		entries:[
			...state.entries,
			item,
		],
	}),
	removeEntry:(state,itemId)=>({
		...state,
		entries:(
			state.entries
			.filter(item=>item.id!==itemId)
		),
	}),
	saveEntries:(state)=>{
		if(typeof(state.entries)!=="object"){return state;}
		localStorage.setItem("wecker_entries",JSON.stringify(state.entries));
		return state;
	},
	editEntryUI:(state,itemId)=>({
		...state,
		editing:itemId,
	}),
	editEntry:(state,[itemId,changes])=>({
		...state,
		entries:(
			state.entries
			.map(item=>
				item.id!==itemId?item:{...item,...changes}
			)
		),
	}),
};

function IndexEntry({
	I:{
		id,
		name,
		time,
	},
	actions,
}){
	return[
		node_dom("tr",null,[
			node_dom("td",{innerText:name}),
			node_dom("td",{innerText:time}),
			node_dom("td",null,[
				node_dom("button[innerText=DEL][style=color:red]",{
					onclick:()=>{
						actions.removeEntry(id);
					},
				}),
				node_dom("button[innerText=EDIT][style=color:orange]",{
					onclick:()=>{
						actions.editEntryUI(id);
					},
				}),
			]),
		]),
	];
}
function ScreenMain({entries,actions}){
	const createEntry=()=>{
		const name=prompt("Wecker-Name:");
		const time=prompt("Wecker-Zeit:");
		actions.addEntry({id:Date.now(),name,time});
	};
	return [
		node_dom("h1[innerText=Wecker]"),
		
		entries.length>0&&
		node_dom("table[border=3px][width=100%]",null,[
			node_dom("tr",null,[
				node_dom("th[innerText=Name]"),
				node_dom("th[innerText=Uhrzeit]"),
				node_dom("th[innerText=Aktionen]"),
			]),

			node_map(IndexEntry,entries,{actions}),
		]),

		entries.length===0&&
		node_dom("p",null,[
			node_dom("span[innerText=Keine Wecker vorhanden, ]"),
			node_dom("a[innerText=Wecker jetzt erstellen!][href=#]",{
				onclick:createEntry,
			}),
		]),
		node_dom("button[innerText=+][title=Wecker hinzufügen]",{
			onclick:createEntry,
		}),
	];
}
function ScreenEditing({entry,actions}){
	return[
		node_dom("h1",{innerText:`Wecker "${entry.name}" bearbeiten`}),
		node_dom("p",null,[
			node_dom("label",null,[
				node_dom("span[innerText=Wecker-Name: ]"),
				node_dom("input",{
					value:entry.name,
					oninput:event=>{
						actions.editEntry([entry.id,{name:event.target.value}]);
					},
				}),
			]),
		]),
		node_dom("p",null,[
			node_dom("label",null,[
				node_dom("span[innerText=Wecker-Zeit: ]"),
				node_dom("input",{
					value:entry.time,
					oninput:event=>{
						actions.editEntry([entry.id,{time:event.target.value}]);
					},
				}),
			]),
		]),

		node_dom("button[innerText=Zurück][style=color:green]",{
			onclick:()=>{
				actions.editEntryUI(-1);
			},
		}),

	];
}

init(()=>{
	const [
		{entries,editing},
		actions,
	]=hook_model(model);
	hook_effect(actions.saveEntries,[entries]);
	return[
		{
			S:{
				fontFamily:"arial",
			},
		},
		[
			editing===-1&&
			node(ScreenMain,{actions,entries}),

			editing!==-1&&
			node(ScreenEditing,{
				actions,
				entry:entries.find(item=>item.id===editing),
			}),
		],
	];
});
</script>
</body>
</html>
